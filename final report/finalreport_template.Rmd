---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Shelby Brown, Katie Lam, Kaeden Hill"
date: "10/31/21"
output: pdf_document
---

```{r load-packages, echo=FALSE}
library(tidyverse) 
library(janitor)

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
``` 

```{r load-data, echo=FALSE}
heart <- readr::read_csv("heart.csv")

```



# Abstract

# Introduction

For this data visualization, chest pain types and their relation to other physiological factors were analyzed to search for an association between factors, such as blood pressure, cholesterol, and exercise, and the type of chest pain a patient experiences. The dataset being analyzed is the Heart Failure Prediction Dataset, retrieved from Kaggle, and compiled from five sets with common variables. These sources are the Hungarian Institute of Cardiology. Budapest, University Hospital, Zurich, Switzerland, University Hospital, Basel, Switzerland, the V.A. Medical Center, Long Beach, and the Cleveland Clinic Foundation. The variables of interest include gender, resting blood pressure (mm Hg), serum cholesterol (mm/d), whether or not the angina was exercise induced, and whether or not the patient was diagnosed with heart disease (**diagnosis before or after the angina??). To allow for the use of statistical tests, each variable was transformed into a categorical variable. 

```{r mean-chol, echo=FALSE}
mean_cholesterol <- heart %>%
  group_by(ChestPainType) %>%
  summarize(mean_cholesterol = mean(Cholesterol))%>%
  print()
```

```{r bar-cholesterol, fig.height = 3, fig.width = 3}
mean_cholesterol %>%
  ggplot()+
  geom_col(mapping = aes(x = ChestPainType, y = mean_cholesterol,  fill = ChestPainType), position = "dodge")+
  	theme(legend.position = "none")+
    labs(title = "Mean Cholesterol Levels",
         subtitle = "By Chest Pain Type",
         x = "Chest Pain Type",
         y = "Mean Cholesterol Levels (mm/dL)")
```


```{r cholesterol}
heart_grouped <- heart %>%
  mutate(chol_level = cut(Cholesterol,
                          breaks = c(-Inf, 120, 200, 239, Inf),
                          labels = c("Low", "Normal", "Intermediate", "High"),
                          right=FALSE))

heart_grouped_chol <- heart_grouped %>%
  filter(Cholesterol > 0)
```

```{r bloodpressure}
heart_grouped <- heart_grouped %>%
  mutate(press_level = cut(RestingBP,
                          breaks = c(-Inf, 120, 130, 140, Inf),
                          labels = c("Normal", "Elevated", "Hypertension 1", "Hypertension 2"),
                          right=FALSE))
```


```{r factor}
heart_grouped <- heart_grouped %>%
  mutate(Sex, sex_factor=ifelse(Sex=="M", 0,1)) %>%
  mutate(ExerciseAngina, exer_factor=ifelse(ExerciseAngina=="N", 0,1))
```

```{r count-sex}
sex_grouped <- heart_grouped %>%
  group_by(ChestPainType, sex_factor) %>%
  summarize(count = n())
```

```{r count-ex}
exer_grouped <- heart_grouped %>%
  group_by(ChestPainType, exer_factor) %>%
  summarize(count = n())
```

```{r count-RBP}
RBP_grouped <- heart_grouped %>%
  group_by(ChestPainType, press_level) %>%
  summarize(count = n())
```

```{r count-cholesterol}
chol_grouped <- heart_grouped_chol %>%
  group_by(ChestPainType, chol_level)%>%
  summarize(count = n())
```

```{r sex-visuals}
sex_grouped %>%
  mutate(sex_factor, sex_name=ifelse(sex_factor==0, "Male","Female")) %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(sex_name)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Sex",
       x = "Chest Pain Type",
       y = "Count",
       fill = "Sex")
```

```{r exer-visuals}
exer_grouped %>%
  mutate(exer_factor, exer_cat=ifelse(exer_factor==0, "No","Yes")) %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(exer_cat)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Exercise Level",
       x = "Chest Pain Type",
       y = "Count",
       fill = "Exercise Induced Angina Status")
```

```{r BP-visuals}
RBP_grouped %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(press_level)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Blood Pressure Level",
       x = "Chest Pain Type",
       y = "Count",
       fill = "Blood Pressure Level")
```

```{r chol-visuals}
chol_grouped %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(chol_level)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Cholesterol Level",
       x = "Chest Pain Type",
       y = "Count",
       fill = "Cholesterol Level")
```

# Statistical Tests
```{r tables}
sex_table <- heart_grouped %>%
  tabyl(Sex, ChestPainType)

exer_table <- heart_grouped %>%
  tabyl(ExerciseAngina, ChestPainType)

RBP_table <- heart_grouped %>%
  tabyl(press_level, ChestPainType)

chol_table <- heart_grouped_chol %>%
  tabyl(chol_level, ChestPainType)

disease_table <- heart_grouped %>%
  tabyl(HeartDisease, ChestPainType)
```

```{r chisq}
chisq.test(sex_table)
chisq.test(exer_table)
```

```{r chi-squared}
chisq.test(chol_table)
chisq.test(RBP_table)
chisq.test(disease_table)
```

```{r new-groups}
heart_grouped2 <- heart_grouped %>%
  filter(ChestPainType %in% c("ATA", "ASY")) 

heart_grouped3 <- heart_grouped %>%
  filter(ChestPainType %in% c("ASY", "NAP")) 

heart_grouped4 <- heart_grouped %>%
  filter(ChestPainType %in% c("TA", "ASY")) 

heart_grouped5 <- heart_grouped %>%
  filter(ChestPainType %in% c("ATA", "NAP")) 

heart_grouped6 <- heart_grouped %>%
  filter(ChestPainType %in% c("ATA", "TA")) 

heart_grouped7 <- heart_grouped %>%
  filter(ChestPainType %in% c("NAP", "TA")) 
```


```{r step-down-cholesterol}
heart_grouped_chol2 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("ATA", "ASY")) 

chol_step <- heart_grouped_chol2 %>%
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step)

heart_grouped_chol3 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("ASY", "NAP")) 

chol_step2 <- heart_grouped_chol3 %>%
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step2)

heart_grouped_chol4 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("TA", "ASY")) 

chol_step3 <- heart_grouped_chol4 %>%
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step3)

heart_grouped_chol5 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("ATA", "NAP")) 

chol_step4 <- heart_grouped_chol5 %>%
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step4)

heart_grouped_chol6 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("ATA", "TA")) 

chol_step5 <- heart_grouped_chol6 %>% #NOT SIGNIFICANT; used fisher bc count was <10 for low:TA
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step5)

heart_grouped_chol7 <- heart_grouped_chol %>%
  filter(ChestPainType %in% c("NAP", "TA")) 

chol_step6 <- heart_grouped_chol7 %>% #NOT SIGNIFICANT
  tabyl(chol_level, ChestPainType)
fisher.test(chol_step6)
```

```{r step-down-sex}
sex_step <- heart_grouped2 %>%
  tabyl(Sex, ChestPainType)
fisher.test(sex_step)

sex_step2 <- heart_grouped3 %>%
  tabyl(Sex, ChestPainType)
fisher.test(sex_step2)

sex_step3 <- heart_grouped4 %>% #NOT SIGNIFICANT
  tabyl(Sex, ChestPainType)
fisher.test(sex_step3)

sex_step4 <- heart_grouped5 %>% #NOT SIGNIFICANT
  tabyl(Sex, ChestPainType)
fisher.test(sex_step4)

sex_step5 <- heart_grouped6 %>% #NOT SIGNIFICANT
  tabyl(Sex, ChestPainType)
fisher.test(sex_step5)

sex_step6 <- heart_grouped7 %>% #NOT SIGNIFICANT
  tabyl(Sex, ChestPainType)
fisher.test(sex_step6)
```

```{r step-down-exercise}
exer_step <- heart_grouped2 %>%
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step)

exer_step2 <- heart_grouped3 %>%
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step2)

exer_step3 <- heart_grouped4 %>% 
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step3)

exer_step4 <- heart_grouped5 %>% 
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step4)

exer_step5 <- heart_grouped6 %>% #NOT SIGNIFICANT
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step5)

exer_step6 <- heart_grouped7 %>% #NOT SIGNIFICANT
  tabyl(ExerciseAngina, ChestPainType)
fisher.test(exer_step6)
```

```{r step-down-RBP}
RBP_step <- heart_grouped2 %>%
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step)

RBP_step2 <- heart_grouped3 %>% #NOT SIG
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step2)

RBP_step3 <- heart_grouped4 %>% #NOT SIG
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step3)

RBP_step4 <- heart_grouped5 %>% 
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step4)

RBP_step5 <- heart_grouped6 %>% 
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step5)

RBP_step6 <- heart_grouped7 %>% #NOT SIG
  tabyl(press_level, ChestPainType)
fisher.test(RBP_step6)
```
```{r disease step down}
disease_step <- heart_grouped2 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step)

disease_step2 <- heart_grouped3 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step2)

disease_step3 <- heart_grouped4 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step3)

disease_step4 <- heart_grouped5 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step4)

disease_step5 <- heart_grouped6 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step5)

disease_step6 <- heart_grouped7 %>%
  tabyl(HeartDisease, ChestPainType)
fisher.test(disease_step)
```

# Results

```{r graphsASY-TA}
  ggplot(data = heart_grouped_chol4)+
  geom_bar(mapping = aes(x = chol_level, fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Cholesterol Level", x = "Cholesterol Level", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped4)+
  geom_bar(mapping = aes(x = press_level, fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain by Blood Pressure Level", x= "Blood Pressure Level", y = "Count", fill = "Chest Pain Type" )

ggplot(data = heart_grouped4)+ #need to change x labels from 0-1 to male-female
  geom_bar(mapping = aes(x = as.factor(sex_factor), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain by Sex", x= "Sex", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped4)+
geom_bar(mapping = aes(x = as.factor(exer_factor), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Whether the Angina Was Exercise Induced", x = "Whether Angina was Exercise Induced", y = "Count", fill = "Chest Pain Type")
```
```{r graphsTA-ATA}
ggplot(data = heart_grouped_chol6)+
  geom_bar(mapping = aes(x = chol_level, fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Cholesterol Level", x = "Cholesterol Level", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped6)+
  geom_bar(mapping = aes(x = press_level, fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain by Blood Pressure Level", x= "Blood Pressure Level", y = "Count", fill = "Chest Pain Type" )

ggplot(data = heart_grouped6)+ #need to change x labels from 0-1 to male-female
  geom_bar(mapping = aes(x = as.factor(sex_factor), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain by Sex", x= "Sex", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped6)+
geom_bar(mapping = aes(x = as.factor(exer_factor), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Whether the Angina Was Exercise Induced", x = "Whether Angina was Exercise Induced", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped4)+
  geom_bar(mapping = aes(x = as.factor(HeartDisease), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Whether the Patient Has Heart Disease", x = "Whether the Patient Has Heart Disease", y = "Count", fill = "Chest Pain Type")

ggplot(data = heart_grouped6)+
  geom_bar(mapping = aes(x = as.factor(HeartDisease), fill = ChestPainType), position = "fill")+
  labs(title = "Type of Chest Pain By Whether the Patient Has Heart Disease", x = "Whether the Patient Has Heart Disease", y = "Count", fill = "Chest Pain Type")
```


```{r sex-stats}

heart_grouped4 %>%
 group_by(Sex) %>%
  summarize(count = n()) %>%
  print()

heart_grouped4 %>%
 group_by(Sex, ChestPainType) %>%
  summarize(count = n()) %>%
  print()

heart_grouped6 %>%
 group_by(Sex) %>%
  summarize(count = n()) %>%
  print()

heart_grouped6 %>%
 group_by(Sex, ChestPainType) %>%
  summarize(count = n()) %>%
  print()

```
```{r exer-stats}

heart_grouped4 %>%
 group_by(ExerciseAngina) %>%
  summarize(count = n()) %>%
  print()

heart_grouped4 %>%
 group_by(ExerciseAngina, ChestPainType) %>%
  summarize(count = n()) %>%
  print()

heart_grouped6 %>%
 group_by(ExerciseAngina) %>%
  summarize(count = n()) %>%
  print()

heart_grouped6 %>%
 group_by(ExerciseAngina, ChestPainType) %>%
  summarize(count = n()) %>%
  print()

```

# Discussion





