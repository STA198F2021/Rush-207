---
title: "An Analysis of Predictors for Types of Chest Pain Experienced"
author: "Rush 207 <br> Shelby Brown, Kaeden Hill, Katie Lam"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(janitor)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r load-data, include=FALSE}
heart <- readr::read_csv("heart.csv")
```

```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "img/watercolour_sys02_img34_teacup-ocean.jpg"
)
```

class: inverse, middle, center



## Background
- Predictors for type of chest pain
  
  - Types of chest pain: Typical Angina (TA), Atypical Angina (ATA), Asymptomatic Angina (ASY), Non-anginal Pain (NAP)

  
  - Predictors: Cholesterol level, Resting Blood Pressure, Exercise Induced Status, Sex, Heart Disease

---

##  Preliminary Plots

```{r recode-species, echo = FALSE, message = FALSE}

heart_grouped <- heart %>%
  mutate(chol_level = cut(Cholesterol,
                          breaks = c(-Inf, 120, 200, 239, Inf),
                          labels = c("Low", "Normal", "Intermediate", "High"),
                          right=FALSE))

heart_grouped_chol <- heart_grouped %>%
  filter(Cholesterol > 0)

heart_grouped <- heart_grouped %>%
  mutate(press_level = cut(RestingBP,
                          breaks = c(-Inf, 120, 130, 140, Inf),
                          labels = c("Normal", "Elevated", "Hypertension 1", "Hypertension 2"),
                          right=FALSE))

heart_grouped <- heart_grouped %>%
  mutate(Sex, sex_factor=ifelse(Sex=="M", 0,1)) %>%
  mutate(ExerciseAngina, exer_factor=ifelse(ExerciseAngina=="N", 0,1))

sex_grouped <- heart_grouped %>%
  group_by(ChestPainType, sex_factor) %>%
  summarize(count = n())

exer_grouped <- heart_grouped %>%
  group_by(ChestPainType, exer_factor) %>%
  summarize(count = n())

RBP_grouped <- heart_grouped %>%
  group_by(ChestPainType, press_level) %>%
  summarize(count = n())

chol_grouped <- heart_grouped_chol %>%
  group_by(ChestPainType, chol_level)%>%
  summarize(count = n())

disease_grouped <- heart_grouped %>%
  group_by(ChestPainType, HeartDisease) %>%
  summarize(count = n())
```

```{r plot-sex-exer-disease, echo = FALSE, warning = FALSE, message = FALSE, fig.show = "hold", out.width = "40%"}

sex_grouped %>%
  mutate(sex_factor, sex_name=ifelse(sex_factor==0, "Male","Female")) %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(sex_name)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Sex",
       x = "Chest Pain Type",
       y = "Proportion",
       fill = "Sex")

exer_grouped %>%
  mutate(exer_factor, exer_cat=ifelse(exer_factor==0, "No","Yes")) %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(exer_cat)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Exercise",
       x = "Chest Pain Type",
       y = "Proportion",
       fill = "Exercise Induced Angina Status")


disease_grouped %>%
  mutate(HeartDisease, disease_cat=ifelse(HeartDisease==0, "Normal","Disease")) %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(disease_cat)), position = "fill")+
  labs(title = "Frequency of Chest Pain Type by Heart Disease",
       x = "Chest Pain Type",
       y = "Proportion",
       fill = "Heart Disease Status")
```

---
## Preliminary Plots

```{r plot-restingBP-Chol, echo = FALSE, warning = FALSE, message = FALSE, fig.show = "hold", out.width = "50%"}
RBP_grouped %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(press_level)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Blood Pressure Level",
       x = "Chest Pain Type",
       y = "Proportion",
       fill = "Blood Pressure Level")

chol_grouped %>%
  ggplot()+
  geom_col(aes(x = ChestPainType, y = count, fill = as.factor(chol_level)), position = "fill") +
  labs(title = "Frequency of Chest Pain Type by Cholesterol Level",
       x = "Chest Pain Type",
       y = "Proportion",
       fill = "Cholesterol Level")

```

---
## Methods

- Preliminary Chi Squared Test

- Step down Fisher's Exact Tests

- Logistic Regression



---
## Results

```{r results-table-1, echo = FALSE}
knitr::include_graphics("Screen_Shot_T1.png")
```



---
## Results

```{r results-table-2, echo = FALSE}
knitr::include_graphics("Screen_Shot_T2.png")

```

---
```{r grouped, echo = FALSE}
heart_grouped4 <- heart_grouped %>%
  filter(ChestPainType %in% c("TA", "ASY")) 

heart_grouped6 <- heart_grouped %>%
  filter(ChestPainType %in% c("ATA", "TA")) 
```

## Heart Disease Results
```{r plot-HD, echo = FALSE, warning = FALSE, message = FALSE, fig.show = "hold", out.width = "50%"}
heart_grouped6 %>%
   mutate(HeartDisease, heart_factor=ifelse(HeartDisease=="1", "Heart Disease", "Normal")) %>%
ggplot()+
  geom_bar(mapping = aes(x = heart_factor, fill = ChestPainType), position = "fill")+
  labs(title = "Proportion of Chest Pain Type",
  subtitle = "By Whether the Patient Has Heart Disease", x = "Whether the Patient Has Heart Disease", y = "Proportion", fill = "Chest Pain Type")

heart_grouped4 %>%
  mutate(HeartDisease, heart_factor=ifelse(HeartDisease=="1", "Heart Disease", "Normal")) %>%
  ggplot()+
  geom_bar(mapping = aes(x = heart_factor, fill = ChestPainType), position = "fill")+
  labs(title = "Proportion of Chest Pain Type",
  subtitle = "By Whether the Patient Has Heart Disease", x = "Whether the Patient Has Heart Disease", y = "Proportion", fill = "Chest Pain Type")
```


---
## Exercise and Blood Pressure Level Results
```{r ex-bp, echo = FALSE, warning = FALSE, message = FALSE, fig.show = "hold", out.width = "50%"}
ggplot(data = heart_grouped6)+
  geom_bar(mapping = aes(x = press_level, fill = ChestPainType), position = "fill")+
  labs(title = "Proportion of Chest Pain Type",
  subtitle = "By Blood Pressure Level", x= "Blood Pressure Level", y = "Proportion", fill = "Chest Pain Type" )

ggplot(data = heart_grouped4)+
geom_bar(mapping = aes(x = as.factor(ExerciseAngina), fill = ChestPainType), position = "fill")+
  labs(title = "Proportion of Chest Pain Type",
  subtitle = "By Whether the Angina Was Exercise Induced", x = "Whether Angina was Exercise Induced", y = "Proportion", fill = "Chest Pain Type")

```

---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

class: inverse, middle, center

# A new section...

---

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r penguins-table, echo = FALSE}
kable(head(penguins), format = "html")
```

---

## Images

```{r castle, echo = FALSE, out.width = "40%", fig.align = "center", fig.cap = "Image credit: Danielle Navarro, Percolate."}
include_graphics("img/watercolour_sys02_img32_percolate.jpg")
```

Or you can also include a full page image. See next slide.

---

background-image: url(img/watercolour_sys02_img32_percolate.jpg)

---

## Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

class: inverse, middle, center

# Wrap up

---

## Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect the majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
